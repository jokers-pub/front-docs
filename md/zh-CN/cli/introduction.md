## 介绍

Joker CLI 是 Joker 前端平台的前端构建工具,旨在提升前端开发体验。

-   **ESM（模块化）支持：** Joker CLI 支持 ESM（EcmaScript Modules）模式，这意味着它可以利用最新的 JavaScript 模块标准，提供按需编译功能。这种模式不仅提高了加载效率，还确保了只有用户实际需要的代码被编译和解析，从而显著提升了应用的响应速度和性能。
-   **前端入口依赖异步静态扫描：** 采用异步方式对前端入口依赖进行静态扫描，可以在不阻塞主线程的情况下执行，这使得三方依赖的预编译成为可以被直接运行的文件。这一特性尤其在冷启动时表现突出，能够极大地减少应用启动时间，优化用户体验。
-   **热更新功能：** 支持热更新意味着开发者在应用运行时可以实时看到代码更改的效果，无需重新加载页面或重启应用，这对于提高开发效率和迭代速度至关重要。
-   **遵循 rollup 插件规范：** 使用 rollup 插件规范意味着 Joker CLI 可以与广泛使用的 rollup 插件生态系统无缝集成，为开发者提供极大的灵活性和扩展性。
-   **生产构建支持：** Joker CLI 支持生产环境的构建，这意味着它能够生成用于生产环境的优化代码，帮助开发者创建高性能、优化的应用程序。

### 按需编译

Joker CLI 利用 [原生 ESM](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)（原生 ES 模块）的方式来提供服务端源码，这一策略将部分打包任务交由浏览器自身处理。具体来说，Joker CLI 仅在浏览器请求源码时进行必要的转换，并按需供给源码。这种方法实现了代码的按需动态导入，意味着代码段只有在它们被实际用到，即出现在用户当前屏幕上时，才会被处理和执行。这不仅提高了开发效率，也优化了资源加载，减少了不必要的性能开销。

### 高效的热更新

许多打包工具的开发服务器会将构建内容存储在内存中，这样在文件发生变化时，只需更新模块图的一部分。尽管如此，这些工具通常仍需重新构建整个应用并触发页面重载，这个过程既耗时又会导致应用状态丢失。为了解决这个问题，打包工具引入了动态模块热替换（HMR）功能，它允许模块在不影响页面其他部分的情况下“热替换”自身，显著提升了开发体验。然而，实际使用中，即使启用了 HMR，随着应用规模的扩大，热更新的速度也会明显减慢。
Joker CLI 采用了不同的方法，它在原生 ESM 的基础上实现了 HMR。当开发者编辑文件时，Joker CLI 只需使编辑的模块及其直接相关的模块失效，通常情况下，这意味着只需更新单个模块。这种精确的更新机制确保了无论应用的大小如何，HMR 都能保持快速和高效，从而提供流畅的开发体验。

### 依赖预构建

Joker CLI 在项目初始化阶段，会执行一次彻底的项目扫描，识别并分析潜在的入口点，进而对项目的依赖关系进行细致的梳理。当检测到对第三方库的依赖时，Joker CLI 采取了一种高效的异步预编译策略。这意味着在首次识别到这些依赖时，Joker CLI 会预先将它们编译成高效的模块，以便在后续的运行过程中，能够直接利用这些预编译的成果，避免了重复的编译步骤。这种做法不仅消除了对 CommonJS、UMD 等旧模块系统的兼容性转换需求，还显著提升了运行时的加载速度和整体性能，从而为开发者提供了一个更加迅捷和高效的前端开发环境。

### 浏览器支持

在开发过程中，Joker CLI 以 esnext 作为其代码转换的目标，这是基于对现代浏览器的假设，即它们支持最新的 JavaScript 和 CSS 特性。这种方法不仅避免了不必要的语法降级，还确保了 Joker CLI 生成的代码尽可能接近原始的源代码，从而保持了代码的完整性和性能。
对于生产环境的构建，Joker CLI 默认面向支持原生 ES 模块、原生 ESM 动态导入以及 import.meta 的现代浏览器。对于需要兼容旧版浏览器的场景，Joker CLI 提供了官方的 `@('@joker.front/cli-plugin-legacy')` 插件以支持这些旧环境。更多关于构建生产环境的详细信息，请参阅相关文档。

### Joker 文件编译

Joker CLI 深度整合了针对 Joker 文件的编译插件，专门用于解析和转换 `Joker SFC`（Joker 单文件组件）文件。这一集成不仅确保了高效和精确的编译过程，还提供了模块热更新（HMR）等高级功能，使得开发者在进行代码迭代时能够即时预览更改，极大地提升了开发效率和体验。
